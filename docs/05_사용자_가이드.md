# SCADA AI 시스템 사용자 가이드

## 1. 개요

본 문서는 SCADA AI 시스템을 처음 사용하는 사용자를 위한 종합 가이드입니다.

### 1.1 시스템 정보

| 항목 | 내용 |
|------|------|
| 시스템명 | SCADA AI 엔터프라이즈 모니터링 시스템 |
| 버전 | v2.0.0 (Enterprise Edition) |
| 접속 URL | http://localhost:9000 |
| API 문서 | http://localhost:9000/docs |
| WebSocket | ws://localhost:9765 |

### 1.2 대상 사용자

- 시스템 관리자 (Admin)
- 운영자 (Operator)
- 모니터링 담당자 (Viewer)

## 2. 시작하기

### 2.1 시스템 요구사항

**최소 요구사항**:
- OS: Windows 10/11, Linux, macOS
- RAM: 4GB 이상
- 디스크: 10GB 여유 공간
- CPU: 2 코어 이상

**권장 요구사항**:
- RAM: 8GB 이상
- 디스크: 20GB 여유 공간
- CPU: 4 코어 이상

**필수 소프트웨어**:
- Docker Desktop 24.0 이상
- Docker Compose 2.0 이상

### 2.2 설치 방법

#### Windows 환경

**1단계: WSL 2 설치** (Windows만 해당)
```bash
# PowerShell 관리자 권한 실행
wsl --install
wsl --set-default-version 2
```

**2단계: Docker Desktop 설치**
1. https://www.docker.com/products/docker-desktop 에서 다운로드
2. 설치 파일 실행
3. WSL 2 통합 활성화

**3단계: 프로젝트 실행**
```bash
# 프로젝트 디렉토리로 이동
cd "C:\새 폴더\scada_ai_project"

# Docker Compose로 시스템 시작
docker-compose up -d
```

**4단계: 시스템 확인**
```bash
# 컨테이너 상태 확인
docker-compose ps

# 로그 확인
docker-compose logs -f scada-ai
```

#### Linux/macOS 환경

```bash
# Docker 및 Docker Compose 설치 (Ubuntu 예시)
sudo apt-get update
sudo apt-get install docker.io docker-compose

# 프로젝트 실행
cd /path/to/scada_ai_project
docker-compose up -d
```

### 2.3 첫 접속

**1. 브라우저에서 접속**
```
http://localhost:9000/docs
```

**2. Swagger UI 확인**
- 모든 API 엔드포인트 목록 확인
- 인터랙티브 API 테스트 가능

## 3. 로그인 및 인증

### 3.1 로그인 방법

#### 방법 1: Swagger UI 사용

1. http://localhost:9000/docs 접속
2. `POST /auth/login` 엔드포인트 찾기
3. "Try it out" 클릭
4. 로그인 정보 입력:
   - username: `admin`
   - password: `admin123`
5. "Execute" 클릭
6. Response에서 `access_token` 복사

#### 방법 2: cURL 사용

```bash
curl -X POST http://localhost:9000/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=admin&password=admin123"
```

**응답 예시**:
```json
{
  "access_token": "demo_token_admin",
  "token_type": "bearer",
  "user": {
    "username": "admin",
    "role": "admin"
  }
}
```

### 3.2 API 호출 시 인증

**Swagger UI에서**:
1. 페이지 상단 "Authorize" 버튼 클릭
2. Value 입력란에 `demo_token_admin` 입력
3. "Authorize" 클릭
4. "Close" 클릭
5. 이제 모든 API 호출 가능

**cURL에서**:
```bash
curl -X GET http://localhost:9000/monitoring/current \
  -H "Authorization: Bearer demo_token_admin"
```

### 3.3 사용자 계정

**기본 제공 계정**:

| 사용자명 | 비밀번호 | 역할 | 권한 |
|---------|---------|------|------|
| admin | admin123 | 관리자 | 모든 권한 |

**역할별 권한**:

| 기능 | Admin | Operator | Viewer |
|------|-------|----------|--------|
| 대시보드 조회 | O | O | O |
| 실시간 모니터링 | O | O | O |
| 알람 확인 | O | O | X |
| 시스템 설정 | O | X | X |
| 사용자 관리 | O | X | X |
| 시스템 종료 | O | X | X |

## 4. 주요 기능 사용법

### 4.1 실시간 모니터링

**API 호출**:
```bash
GET /monitoring/current
```

**Swagger UI에서**:
1. `GET /monitoring/current` 엔드포인트 찾기
2. "Try it out" 클릭
3. "Execute" 클릭

**응답 데이터**:
```json
{
  "timestamp": "2025-10-14T10:30:00",
  "sensors": [
    {
      "id": "temp_001",
      "name": "Inlet Temperature",
      "value": 22.5,
      "unit": "°C",
      "status": "normal",
      "min": 18.0,
      "max": 25.0
    },
    {
      "id": "pressure_001",
      "name": "System Pressure",
      "value": 3.2,
      "unit": "bar",
      "status": "normal",
      "min": 2.0,
      "max": 5.0
    },
    {
      "id": "flow_001",
      "name": "Flow Rate",
      "value": 320.5,
      "unit": "L/min",
      "status": "normal",
      "min": 100.0,
      "max": 500.0
    },
    {
      "id": "tank_001",
      "name": "Tank Level",
      "value": 75.3,
      "unit": "%",
      "status": "normal",
      "min": 30.0,
      "max": 95.0
    },
    {
      "id": "ph_001",
      "name": "pH Level",
      "value": 7.2,
      "unit": "pH",
      "status": "normal",
      "min": 6.5,
      "max": 8.5
    }
  ],
  "alerts": [],
  "system_status": "running"
}
```

**센서 상태 의미**:
- `normal`: 정상 범위
- `warning`: 주의 필요
- `critical`: 즉시 조치 필요
- `failure`: 센서 고장

### 4.2 AI 분석 대시보드

**API 호출**:
```bash
GET /analytics/dashboard
```

**응답 데이터**:
```json
{
  "timestamp": "2025-10-14T10:30:00",
  "predictions": {
    "next_hour": {
      "temperature": 23.1,
      "pressure": 3.3,
      "confidence": 0.87
    },
    "next_day": {
      "temperature": 22.8,
      "pressure": 3.2,
      "confidence": 0.72
    }
  },
  "anomalies": [
    {
      "sensor_id": "temp_001",
      "timestamp": "2025-10-14T09:45:00",
      "anomaly_score": 0.85,
      "severity": "medium"
    }
  ],
  "recommendations": [
    "시스템 정상 작동 중",
    "다음 1시간 내 온도 상승 예상 (약 0.6°C)",
    "정기 점검 권장: 2025-10-20"
  ],
  "model_performance": {
    "accuracy": 0.94,
    "last_trained": "2025-10-13T08:00:00"
  }
}
```

**데이터 해석**:
- `confidence`: 예측 신뢰도 (0-1, 높을수록 정확)
- `anomaly_score`: 이상 점수 (0-1, 높을수록 이상)
- `severity`: 심각도 (low, medium, high, critical)

### 4.3 보고서 생성

**API 호출**:
```bash
POST /reports/generate
```

**요청 데이터**:
```json
{
  "report_type": "daily",
  "format": "pdf",
  "date": "2025-10-14",
  "include_charts": true,
  "include_analytics": true
}
```

**보고서 종류**:
- `daily`: 일일 운영 보고서
- `weekly`: 주간 요약 보고서
- `monthly`: 월간 분석 보고서
- `incident`: 사고 보고서
- `compliance`: 규정 준수 감사 보고서

**출력 형식**:
- `pdf`: PDF 파일
- `html`: HTML 파일
- `excel`: Excel 파일
- `json`: JSON 데이터

**응답**:
```json
{
  "report_id": "RPT-20251014-001",
  "filename": "daily_report_20251014.pdf",
  "download_url": "/reports/download/RPT-20251014-001",
  "generated_at": "2025-10-14T10:30:15",
  "file_size": "2.5 MB"
}
```

### 4.4 규정 준수 현황

**API 호출**:
```bash
GET /compliance/dashboard
```

**응답 데이터**:
```json
{
  "overall_compliance": 97,
  "standards": {
    "ISO27001": {
      "compliance": 98,
      "passed_checks": 49,
      "failed_checks": 1,
      "issues": [
        {
          "check_id": "ISO27001-A.12.4.1",
          "description": "Event logging",
          "status": "failed",
          "recommendation": "Enable comprehensive event logging"
        }
      ]
    },
    "IEC62443": {
      "compliance": 95,
      "passed_checks": 19,
      "failed_checks": 1,
      "issues": [
        {
          "check_id": "IEC62443-3-3-SR1.1",
          "description": "Human user identification",
          "status": "failed",
          "recommendation": "Implement multi-factor authentication"
        }
      ]
    },
    "NIST": {
      "compliance": 98,
      "passed_checks": 49,
      "failed_checks": 1,
      "issues": [
        {
          "check_id": "NIST-AC-2",
          "description": "Account management",
          "status": "failed",
          "recommendation": "Review inactive accounts"
        }
      ]
    }
  },
  "last_audit": "2025-10-13T00:00:00",
  "next_audit": "2025-10-14T00:00:00"
}
```

**규정 준수 점수 의미**:
- 100-95%: 우수 (Excellent)
- 94-85%: 양호 (Good)
- 84-70%: 개선 필요 (Needs Improvement)
- 69% 이하: 부적합 (Non-Compliant)

### 4.5 시스템 상태 확인

**API 호출**:
```bash
GET /status
```

**응답 데이터**:
```json
{
  "status": "running",
  "uptime_seconds": 3600,
  "uptime_formatted": "1 hour, 0 minutes",
  "version": "2.0.0",
  "environment": "production",
  "modules": {
    "security_framework": true,
    "protocol_manager": true,
    "monitoring_system": true,
    "analytics_engine": true,
    "report_generator": true,
    "compliance_manager": true,
    "integration_manager": true,
    "data_pipeline": true
  },
  "database": {
    "type": "PostgreSQL",
    "status": "connected",
    "version": "14.0"
  },
  "cache": {
    "type": "Redis",
    "status": "connected",
    "version": "7.0"
  },
  "active_connections": 5,
  "processed_messages": 12450,
  "memory_usage_mb": 2300,
  "cpu_usage_percent": 0.3
}
```

## 5. WebSocket 실시간 스트리밍

### 5.1 WebSocket 연결

**JavaScript 예시**:
```javascript
// WebSocket 연결
const ws = new WebSocket('ws://localhost:9765/monitoring/stream');

// 연결 성공
ws.onopen = function() {
    console.log('Connected to SCADA AI System');
};

// 데이터 수신
ws.onmessage = function(event) {
    const data = JSON.parse(event.data);
    console.log('Sensor data:', data);
    // 데이터 시각화 또는 처리
    updateDashboard(data);
};

// 에러 처리
ws.onerror = function(error) {
    console.error('WebSocket error:', error);
};

// 연결 종료
ws.onclose = function() {
    console.log('Disconnected from SCADA AI System');
    // 재연결 로직
    setTimeout(connect, 5000);
};
```

**Python 예시**:
```python
import websocket
import json

def on_message(ws, message):
    data = json.loads(message)
    print(f"Sensor data: {data}")

def on_error(ws, error):
    print(f"Error: {error}")

def on_close(ws):
    print("Disconnected")

def on_open(ws):
    print("Connected to SCADA AI System")

# WebSocket 연결
ws = websocket.WebSocketApp(
    "ws://localhost:9765/monitoring/stream",
    on_message=on_message,
    on_error=on_error,
    on_close=on_close,
    on_open=on_open
)

ws.run_forever()
```

### 5.2 수신 데이터 형식

**실시간 스트리밍 데이터**:
```json
{
  "timestamp": "2025-10-14T10:30:00.123Z",
  "data": {
    "sensors": [
      {
        "id": "temp_001",
        "value": 22.5,
        "status": "normal"
      },
      {
        "id": "pressure_001",
        "value": 3.2,
        "status": "normal"
      }
    ],
    "alerts": []
  }
}
```

## 6. 트러블슈팅

### 6.1 일반적인 문제

#### 문제 1: 컨테이너가 시작되지 않음

**증상**:
```bash
$ docker-compose up
ERROR: ...
```

**해결**:
```bash
# 1. 기존 컨테이너 중지 및 제거
docker-compose down

# 2. 이미지 재빌드
docker-compose build --no-cache

# 3. 재시작
docker-compose up -d

# 4. 로그 확인
docker-compose logs -f
```

#### 문제 2: 인증 오류 (401 Unauthorized)

**증상**:
```json
{"detail": "Authentication required"}
```

**해결**:
1. 로그인 API로 새 토큰 받기
2. Authorization 헤더에 `Bearer {token}` 형식으로 추가
3. Swagger UI의 경우 "Authorize" 버튼 클릭 후 토큰 입력

#### 문제 3: 데이터가 표시되지 않음

**증상**:
- 센서 데이터 빈 배열
- `"sensors": []`

**원인**:
- 시스템이 막 시작됨 (데이터 수집 전)
- 데이터 파이프라인 미작동

**해결**:
```bash
# 1. 시스템 상태 확인
curl http://localhost:9000/status

# 2. 파이프라인 상태 확인
curl http://localhost:9000/pipeline/status

# 3. 1-2분 대기 후 재시도
```

#### 문제 4: 포트 충돌

**증상**:
```bash
ERROR: Port 9000 is already in use
```

**해결**:
```bash
# 1. 포트 사용 프로세스 확인 (Windows)
netstat -ano | findstr :9000

# 2. 프로세스 종료 또는 다른 포트 사용
# docker-compose.yml에서 포트 변경
ports:
  - "9001:9000"  # 9001로 변경
```

### 6.2 로그 확인 방법

**전체 로그**:
```bash
docker-compose logs
```

**특정 컨테이너 로그**:
```bash
docker-compose logs scada-ai
docker-compose logs postgres
docker-compose logs redis
```

**실시간 로그 스트리밍**:
```bash
docker-compose logs -f scada-ai
```

**최근 N줄만 보기**:
```bash
docker-compose logs --tail=100 scada-ai
```

### 6.3 데이터베이스 접속

**PostgreSQL 접속**:
```bash
docker-compose exec postgres psql -U scada_user -d scada_ai
```

**테이블 확인**:
```sql
\dt
```

**데이터 조회**:
```sql
SELECT * FROM sensor_data LIMIT 10;
```

**Redis 접속**:
```bash
docker-compose exec redis redis-cli
```

**키 확인**:
```redis
KEYS *
GET sensor:current:temp_001
```

## 7. 시스템 관리

### 7.1 시작 및 중지

**시작**:
```bash
docker-compose up -d
```

**중지**:
```bash
docker-compose stop
```

**재시작**:
```bash
docker-compose restart
```

**중지 및 제거**:
```bash
docker-compose down
```

**볼륨까지 제거** (주의: 데이터 삭제):
```bash
docker-compose down -v
```

### 7.2 백업 및 복원

**데이터베이스 백업**:
```bash
# PostgreSQL 백업
docker-compose exec postgres pg_dump -U scada_user scada_ai > backup_$(date +%Y%m%d).sql
```

**데이터베이스 복원**:
```bash
# PostgreSQL 복원
docker-compose exec -T postgres psql -U scada_user scada_ai < backup_20251014.sql
```

**파일 백업**:
```bash
# 로그, 데이터, 보고서 백업
tar -czf scada_backup_$(date +%Y%m%d).tar.gz logs/ data/ reports/
```

### 7.3 업데이트

**시스템 업데이트**:
```bash
# 1. 백업
docker-compose exec postgres pg_dump -U scada_user scada_ai > backup_before_update.sql

# 2. 중지
docker-compose down

# 3. 코드 업데이트
git pull  # 또는 새 버전 다운로드

# 4. 재빌드
docker-compose build --no-cache

# 5. 시작
docker-compose up -d

# 6. 확인
docker-compose logs -f
```

## 8. 모범 사례

### 8.1 보안

1. **비밀번호 변경**: 기본 비밀번호(`admin123`) 즉시 변경
2. **HTTPS 사용**: 프로덕션에서는 HTTPS 필수
3. **방화벽 설정**: 필요한 포트만 개방
4. **정기 업데이트**: 보안 패치 적용
5. **로그 모니터링**: 보안 이벤트 주기적 확인

### 8.2 성능

1. **정기 백업**: 일일 백업 권장
2. **로그 정리**: 오래된 로그 정기적으로 삭제
3. **데이터베이스 최적화**: 인덱스 재구성
4. **리소스 모니터링**: CPU, 메모리 사용률 확인

### 8.3 운영

1. **정기 점검**: 주간 시스템 상태 확인
2. **문서화**: 변경 사항 기록
3. **알람 설정**: 중요 이벤트 알림 설정
4. **교육**: 운영자 정기 교육

## 9. FAQ

**Q1: 시스템을 재시작하면 데이터가 사라지나요?**

A: 아니오. Docker 볼륨에 데이터가 저장되어 재시작해도 유지됩니다. 단, `docker-compose down -v` 명령어는 볼륨까지 삭제하므로 주의하세요.

**Q2: 다른 컴퓨터에서 접속할 수 있나요?**

A: 네. docker-compose.yml에서 `0.0.0.0:9000:9000`으로 설정되어 있으면 네트워크의 다른 컴퓨터에서 `http://{서버IP}:9000`으로 접속 가능합니다.

**Q3: 센서 데이터는 어디에 저장되나요?**

A: PostgreSQL 데이터베이스의 `sensor_data` 테이블에 저장됩니다. 실시간 데이터는 Redis 캐시에도 저장됩니다.

**Q4: 보고서는 어디에 저장되나요?**

A: `reports/` 디렉토리에 저장됩니다. Docker 볼륨 마운트로 호스트 시스템에서도 접근 가능합니다.

**Q5: 시스템을 중지하지 않고 설정을 변경할 수 있나요?**

A: 일부 설정은 API를 통해 동적으로 변경 가능하지만, 대부분의 설정 변경은 재시작이 필요합니다.

## 10. 지원 및 문의

### 10.1 문제 보고

GitHub Issues를 통해 버그 및 개선 사항을 보고해 주세요.

### 10.2 추가 문서

- API 문서: http://localhost:9000/docs
- 개발자 가이드: `docs/02_개발계획서.md`
- 문제 해결: `docs/04_완료보고서/07_문제해결_과정.md`

---

**문서 버전**: 1.0
**작성일**: 2025년 10월 14일
**문서 경로**: `C:\새 폴더\scada_ai_project\docs\05_사용자_가이드.md`
